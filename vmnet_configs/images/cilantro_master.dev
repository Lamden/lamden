FROM ubuntu:18.04

MAINTAINER Falcon Wong version: 0.1

COPY . /app
WORKDIR /app

ENV DEBIAN_FRONTEND noninteractive

RUN apt-get update \
    && apt-get install -y software-properties-common \
    && apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4 \
    && add-apt-repository 'deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse'  \
    && apt-get remove -y software-properties-common \
    && apt-get update \
    && apt-get install -y mongodb-org

# Install Python requirements
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        sudo ssh tar gzip ca-certificates curl \
        openssl python3.6 \
        python3-pip python3.6-dev build-essential \
        gcc g++ git autoconf automake \
        libffi-dev libtool dpkg \
        gsl-bin zlib1g-dev libboost-all-dev \
        nano \
    && pip3 install --upgrade setuptools wheel \
    && pip3 install -r requirements.txt \
    && pip3 install -r dev-requirements.txt \
    && rm -rf pynacl 2>/dev/null \
    && git clone https://github.com/pyca/pynacl.git \
        && cd pynacl \
        && cythonize -ki src/nacl \
        && python3 setup.py install \
        && cd - \
    && rm -rf pynacl capnproto \
    && apt-get remove -y --allow-remove-essential \
        build-essential \
        gcc g++ \
        libffi-dev libtool \
        gsl-bin zlib1g-dev libboost-all-dev \
        autoconf automake \
    && apt autoremove -y \
    && rm -rf /var/lib/apt/lists/*

CMD bash ./scripts/start_mongo.sh
